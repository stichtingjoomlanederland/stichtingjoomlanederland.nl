let rsfpJdideal=function(a){this.formId=a,this.products=[this.formId],this.products[this.formId]=[],this.components=[],this.price=0,this.totalFieldname="",this.numberDecimals=null,this.decimal=null,this.thousands=null,this.taxtype=null,this.tax=null,this.priceFormat=/^[-]?\d+([.,]\d+)?$/,this.randomId=null,this.setRandomId=function(a){this.randomId=a},this.setTax=function(a,b){this.taxtype=a,this.tax=b},this.setDecimals=function(a,b,c){this.numberDecimals=a,this.decimal=b,this.thousands=c},this.setTotalField=function(a){this.totalFieldname=a},this.addProduct=function(a,b){let c=this.priceFormat.test(b);c&&("[object Array]"!==Object.prototype.toString.call(this.products[this.formId])&&(this.products[this.formId]=[]),this.products[this.formId][a]=b)},this.addComponent=function(a,b){"[object Array]"!==Object.prototype.toString.call(this.components[this.formId])&&(this.components[this.formId]=[]),-1===this.components[this.formId].indexOf(a)&&(this.components[this.formId][a]=b)},this.calculatePrice=()=>{if(void 0===this.products[this.formId])return console.log("No products"),console.log(this.products),void console.log(this.formId);this.price=0;let a=document.querySelectorAll("[data-ropayments-field=single]");if(0<a.length)for(let b,c=0;c<a.length;c++)b=parseFloat(a[c].value),!0!==isNaN(b)&&(this.price+=b);let b=document.querySelectorAll("[data-ropayments-field=input]");if(0<b.length)for(let a,c=0;c<b.length;c++)if(a=b[c].value,0<a.length){let b=this.cleanPrice(a);this.price+=b}for(let a in this.components[this.formId]){if("length"==a||!this.components[this.formId].hasOwnProperty(a))continue;let b=this.components[this.formId][a],c=document.querySelectorAll(`select[name="form[${b}][]"]`),d=document.querySelectorAll("[name^=\"form\\[ropayments\\]\\[quantity\\]\\["+b+"\\]\"]");if(null!==c&&0<c.length)for(let a=0;a<c.length;a++){let e=c[a],f="undefined"==typeof d[a]?null:d[a];for(let a=0;a<e.options.length;a++)if(!0===e.options[a].selected){let c=this.products[this.formId][`${b}${a}|_|${e.options[a].value}`],d=this.priceFormat.test(c);if(d){let a=1;null!==f&&(a=f.value),0<a.length&&(c*=this.cleanPrice(a)),this.price+=parseFloat(c)}}}let e=document.querySelectorAll(`input[type="checkbox"][name^="form[${b}]"]`);d=document.querySelectorAll("[name^=\"form\\[ropayments\\]\\[quantity\\]\\["+b+"\\]\"]");for(let a=0;a<e.length;a++)if(!0===e[a].checked)if(void 0!==this.products[this.formId][b+a+"|_|"+e[a].value]){let c=this.products[this.formId][b+a+"|_|"+e[a].value],f=this.priceFormat.test(c);if(f){let b=1;0<d.length&&(b=d[a].value),0<b.length&&(c*=this.cleanPrice(b)),this.price+=parseFloat(c)}}else console.log(this.products),console.log("No product found");let f=document.querySelectorAll("input[type=\"radio\"][name^=\"form\\["+b+"\\]\"]");d=document.querySelectorAll("[name^=\"form\\[ropayments\\]\\[quantity\\]\\["+b+"\\]\"]");for(let a=0;a<f.length;a++)if(!0===f[a].checked&&void 0!==this.products[this.formId][b+a+"|_|"+f[a].value]){let c=this.products[this.formId][b+a+"|_|"+f[a].value],e=this.priceFormat.test(c);if(e){let b=1;0<d.length&&(b=d[a].value),0<b.length&&(c*=this.cleanPrice(b)),this.price+=parseFloat(c)}}}this.addTax(),this.showTotal(),this.applyCoupon()},this.addTax=function(){0<this.price&&(this.price=this.taxtype?this.price+this.tax:this.price*(this.tax/100+1))},this.showTotal=function(){let a=document.getElementById("jdideal_total_"+this.formId);if(a&&(a.innerHTML=this.number_format(this.price,this.numberDecimals,this.decimal,this.thousands)),0<this.totalFieldname.length){let a=document.getElementById(this.totalFieldname);a&&(a.value=this.number_format(this.price,this.numberDecimals,".",""))}},this.cleanPrice=function(a){return-1!==a.indexOf(".")&&-1!==a.indexOf(",")&&(a=a.replace(".","")),parseFloat(a.replace(/,/g,"."))},this.number_format=function(a,b,c,d){let e=a,f=b;e=isFinite(+e)?+e:0,f=isFinite(+f)?Math.abs(f):0;let g,h,j="undefined"==typeof d?",":d,k="undefined"==typeof c?".":c,l=0<f?e.toFixed(f):Math.round(e).toFixed(f),m=Math.abs(e).toFixed(f);return 1e3<=m?(g=m.split(/\D/),h=g[0].length%3||3,g[0]=l.slice(0,h+(0>e))+g[0].slice(h).replace(/(\d{3})/g,j+"$1"),l=g.join(k)):l=l.replace(".",k),l},this.applyCoupon=function(){const a=document.querySelector("[data-ropayments-field=discount]");if(!a||0===a.value.length||parseInt(a.dataset.formid)!==this.formId)return;a.classList.remove("payment-code-correct");const b=JSON.parse(a.dataset.discounts),c=CryptoJS.MD5(a.value).toString();if(!b.hasOwnProperty(c))return;let d=b[c];-1<d.indexOf("%")?(d=parseFloat(d.replace("%","")),!isNaN(d)&&(this.price=(100-d)/100*this.price)):(d=parseFloat(d),!isNaN(d)&&(this.price-=d)),this.showTotal(),a.classList.add("payment-code-correct")}};
